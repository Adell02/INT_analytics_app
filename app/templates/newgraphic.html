{% extends 'template.html' %}

{% block title %} New Graphic {% endblock %}
{% block head%} 
<link rel="stylesheet" href="../static/css/newgraphic.css">
{% endblock %}

{% block content %} 
        
        <div class="margen">
        </div>
        
        <div class="recuadro-superior-analytics" >
            <form method="POST" name="newgraphic_form">

                <div class="custom-select-newgraphic" >
                    <select id="graph_type" name="graph_type" placeholder="Select Graph Type:">
                      <option value="none">Select Graph Type:</option>
                      <option value="Pie_Chart">Pie Chart</option>
                      <option value="Bar_Chart">Bar Chart</option>
                      <option value="Histogram_Distribution">Histogram / Distribution</option>
                      <option value="Scatter_Plot">Scatter Plot</option>
                      <option value="Line_Chart">Line Chart</option>
                    </select>
                </div>

                
                <div class="custom-select-newgraphic" >
                    <select  name="VIN_select" id="VIN_select" placeholder="Select VIN:" >
                        <option value="">Select VIN:</option>
                        {% for VIN in available_vin %}
                            <option value={{ VIN }}> {{VIN}} </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="new-graphic-superior" >
                    <input type="text" class="new-graphic-input" id="graph_title" name="graph_title" placeholder="Enter Graph Title" value="">
                </div>

                <div class="custom-select-newgraphic" >
                    <select  name="graph_data_x" id="graph_data_x" placeholder="Select Graph Data 'x':" >
                        <option value="">Select Graph Data "x":</option>
                        {% for col in columns_list %}
                            <option value="{{ col }}"> {{ col }} </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="custom-select-newgraphic"  >
                    <select multiple name="graph_data_y[]" id = "graph_data_y[]" placeholder="Select Graph Data 'y':">
                        <option value="">Select Graph Data "y":</option>
                        {% for col in columns_list %}
                            <option value="{{ col }}"> {{ col }} </option>
                        {% endfor %}
                    </select>
                </div>


        </div>
        <li class="recuadro-inferior-newgraphic" >
            <div class="recuadro-in-left-newgraphic">
                <div class="new-graphic-superior-left" >
                    <input type="checkbox" id="trendline" name="trendline" class="trendline-newgraphic">
                      Trendline
                </div>
            </div>
            <div class="recuadro-in-middle-newgraphic">
                <button type="submit"  class="new-graphic-save">Generate Graphic</button>
            </div>
            <div class="recuadro-in-right-newgraphic"> </div>
        </li>
        </form>
        <div class="recuadro-medio-newgraphic" >
            <div class="graph-container recuadro-w100" >
            </div>
        </div>
        


        <script>

            const plot = {{ plots | tojson | safe }}; 
            const containers = document.getElementsByClassName("graph-container"); 
            var graph_divs = [];
            
            if (containers[0].childElementCount == 0){
                create_newgraphic(); 
            }

            
            var config = {{config | safe }};
            var graph_type ;
            var graph_title ;
            var graph_data_x;
            var graph_data_y;
            var trendline ;
            var trendlineblock ;
            var VIN_select;

            //graph_type.value = config[0];
            //graph_title.value = config[1];
            //graph_data_x.value = config[2];
            //graph_data_y.value = config[3];
            //VIN_select.value = config[4];
            

            function default_config() {
                if (graph_type.value == "Pie_Chart" || graph_type.value == "Histogram_Distribution") {
                    graph_data_x.style.display = "none";
                } else {
                    graph_data_x.style.display = "block"; 
                }
                if(graph_type.value == "Scatter_Plot" ){
                    trendline.style.display="flex";
                    trendlineblock.style.display="flex";
                    
                } else {
                    trendline.style.display="none"
                    trendlineblock.style.display="none"
                }
            }
            

            window.onload = function() {
                graph_type = document.getElementById("graph_type") ;
                graph_title = document.getElementById("graph_title");
                graph_data_x = document.getElementById("graph_data_x");
                graph_data_y = document.getElementById("graph_data_y[]");
                trendline = document.getElementById("trendline");
                trendlineblock = document.querySelector('.new-graphic-superior-left');
                VIN_select= document.getElementById("VIN_select");

                graph_type.value = config[0];
                graph_title.value = config[1];
                graph_data_x.value = config[2];
                graph_data_y.value = config[3];
                VIN_select.value = config[4];

                graph_type.addEventListener("change", default_config);
                default_config();
            };
            
                        
        </script>

{% endblock %}
